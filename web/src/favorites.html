<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>我的收藏</title>
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:20px;background:#0b1020;color:#eaf0ff}
      .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
      button{padding:8px 12px;border:0;border-radius:8px;background:#4f7cff;color:#fff;cursor:pointer}
      .card{background:#111936;border:1px solid #24345f;border-radius:10px;padding:10px;margin:8px 0}
      .muted{color:#9fb0df;font-size:12px}
    </style>
  </head>
  <body>
    <div class="card" style="margin-bottom:12px">
      <div class="row">
        <a href="/info-push/github-acceptance.html"><button style="background:#4f7cff">首页验收页</button></a>
        <a href="/info-push/sources.html"><button style="background:#2b8a3e">信息源管理</button></a>
        <a href="/info-push/favorites.html"><button style="background:#e67700">我的收藏</button></a>
      </div>
    </div>

    <h2>我的收藏（最新在前）</h2>
    <div class="row">
      <button id="refresh">刷新收藏</button>
    </div>
    <div id="list"></div>

<script>
const API='/info-api';
const listEl=document.getElementById('list');

async function loadFavorites(){
  const r = await fetch(`${API}/v1/favorites`);
  const d = await r.json();
  const items = d.items || [];
  listEl.innerHTML = items.map(i=>`<div class='card'><div><strong>${i.title}</strong></div><div>${i.summary||''}</div><div class='muted'>收藏时间：${i.favoritedAt||''}</div><a href='${i.url}' target='_blank'>${i.url}</a><div style='margin-top:8px'><button class='del' data-id='${i.id}' style='background:#e03131'>取消收藏</button></div></div>`).join('') || '<div class="card">暂无收藏</div>';
  document.querySelectorAll('.del').forEach((b)=>b.onclick=async()=>{
    await fetch(`${API}/v1/favorites/${encodeURIComponent(b.dataset.id)}`, { method:'DELETE' });
    await loadFavorites();
  });
}

document.getElementById('refresh').onclick=loadFavorites;
loadFavorites();
</script>
  </body>
</html>
